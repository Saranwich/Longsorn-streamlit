import whisper
from pathlib import Path  # 1. Import Path р╣Ар╕Вр╣Йр╕▓р╕бр╕▓

# --- р╣Ар╕ер╕╖р╕нр╕Бр╕Вр╕Щр╕▓р╕Фр╣Вр╕бр╣Ар╕Фр╕е ---  р╕бр╕╡р╣Гр╕лр╣Йр╣Ар╕ер╕╖р╕нр╕Б: "tiny", "base", "small", "medium", "large"
# (р╕кр╣Ир╕зр╕Щр╕Щр╕╡р╣Йр╣Ар╕лр╕бр╕╖р╕нр╕Щр╣Ар╕Фр╕┤р╕б)
MODEL_SIZE = "large"

# --- р╕гр╕░р╕Ър╕╕р╣Др╕Яр╕ер╣Мр╣Ар╕кр╕╡р╕вр╕З (р╣Бр╕Ър╕Ър╕бр╕╖р╕нр╣Вр╕Ыр╕г) ---
# 2. р╕кр╕гр╣Йр╕▓р╕З Path р╣Бр╕Ър╕Ър╕Бр╕▒р╕Щр╕Бр╕гр╕░р╕кр╕╕р╕Щ
# Path(__file__) р╕Др╕╖р╕н path р╕Вр╕нр╕Зр╣Др╕Яр╕ер╣М .py р╕Щр╕╡р╣Йр╣Бр╕Ър╕Ър╣Ар╕Хр╣Зр╕бр╣Ж
# .parent р╕Др╕╖р╕нр╕Бр╕▓р╕гр╕Ър╕нр╕Бр╣Гр╕лр╣Йр╣Др╕Ыр╕Чр╕╡р╣Ир╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╕Чр╕╡р╣Ир╣Др╕Яр╕ер╣Мр╕Щр╕╡р╣Йр╕нр╕вр╕╣р╣И
# р╣Бр╕ер╣Йр╕зр╕Др╣Ир╕нр╕вр╕Хр╣Ир╕нр╕Фр╣Йр╕зр╕в / "assets" / "test_whisper.mp3"
try:
    script_dir = Path(__file__).parent
    audio_file_path = script_dir / "assets" / "test_whisper.mp3"
except NameError:
    # р╕Цр╣Йр╕▓р╣Ар╕Бр╕┤р╕Фр╕гр╕▒р╕Щр╣Гр╕Щр╣Вр╕лр╕бр╕Ф interactive р╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕бр╕╡ __file__ р╣Гр╕лр╣Йр╣Гр╕Кр╣Й path р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╣Бр╕Чр╕Щ
    audio_file_path = Path("assets") / "test_whisper.mp3"


# --- р╣Ар╕Юр╕┤р╣Ир╕бр╣Вр╕Др╣Йр╕Фр╕кр╕│р╕лр╕гр╕▒р╕Ъ Debug ---
# р╣Ар╕гр╕▓р╕Ир╕░р╕Юр╕┤р╕бр╕Юр╣Мр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╣Ир╕нр╕Щр╕Чр╕╡р╣Ир╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕бр╕Ир╕░р╣Ар╕гр╕┤р╣Ир╕бр╕Чр╕│р╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З
print("-" * 30)
print(f"DEBUG: Path р╕Чр╕╡р╣Ир╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕бр╕кр╕гр╣Йр╕▓р╕Зр╕Вр╕╢р╣Йр╕Щр╕Др╕╖р╕н: {audio_file_path.resolve()}")
print(f"DEBUG: Path р╕Щр╕╡р╣Йр╕бр╕╡р╕нр╕вр╕╣р╣Ир╕Ир╕гр╕┤р╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И? -> {audio_file_path.exists()}")
print("-" * 30)



try:
    print(f"р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╣Вр╕бр╣Ар╕Фр╕е Whisper р╕Вр╕Щр╕▓р╕Ф '{MODEL_SIZE}'...")
    print("(р╕Др╕гр╕▒р╣Йр╕Зр╣Бр╕гр╕Бр╕нр╕▓р╕Ир╕бр╕╡р╕Бр╕▓р╕гр╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣Мр╣Вр╕бр╣Ар╕Фр╕ер╕Ир╕▓р╕Бр╣Ар╕Щр╣Зр╕Х р╣Вр╕Ыр╕гр╕Фр╕гр╕н...)")
    
    # р╣Вр╕лр╕ер╕Фр╣Вр╕бр╣Ар╕Фр╕ер╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╣Гр╕Щр╕лр╕Щр╣Ир╕зр╕вр╕Др╕зр╕▓р╕бр╕Ир╕│
    model = whisper.load_model(MODEL_SIZE)

    print("-" * 20)
    print("тЬЕ р╣Вр╕лр╕ер╕Фр╣Вр╕бр╣Ар╕Фр╕ер╕кр╕│р╣Ар╕гр╣Зр╕И!")
    print(f"тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Цр╕нр╕Фр╣Ар╕кр╕╡р╕вр╕Зр╣Др╕Яр╕ер╣М: {audio_file_path}")
    print("тА╝я╕П  р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕Ир╕░р╕Щр╕▓р╕Щр╕бр╕▓р╕Бр╕Бр╕Бр╕Бр╕Б... р╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕нр╕▓р╕Ир╕Ир╕░р╕Щр╕┤р╣Ир╕Зр╣Др╕Ыр╣Ар╕ер╕в р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Хр╕Бр╣Гр╕Ир╕Щр╕░!")
    print("тА╝я╕П  р╣Др╕Ыр╕Кр╕Зр╕Бр╕▓р╣Бр╕Я р╕лр╕▓р╕нр╕░р╣Др╕гр╕Чр╕│р╕гр╕нр╣Др╕Фр╣Йр╣Ар╕ер╕в... (15-20 р╕Щр╕▓р╕Чр╕╡ р╕лр╕гр╕╖р╕нр╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓)")
    print("-" * 20)
    
    # р╕кр╕▒р╣Ир╕Зр╣Гр╕лр╣Йр╣Вр╕бр╣Ар╕Фр╕ер╣Ар╕гр╕┤р╣Ир╕бр╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕нр╕Фр╣Ар╕кр╕╡р╕вр╕З
    result = model.transcribe(str(audio_file_path), fp16=False)

    # р╕Юр╕┤р╕бр╕Юр╣Мр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
    print("ЁЯОЙЁЯОЙЁЯОЙ р╕Цр╕нр╕Фр╣Ар╕кр╕╡р╕вр╕Зр╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з! ЁЯОЙЁЯОЙЁЯОЙ")
    print("р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╣Др╕Фр╣Йр╕Др╕╖р╕н:")
    print(result["text"])

except FileNotFoundError:
    print(f"тЭМ Error: р╣Др╕бр╣Ир╕Юр╕Ър╣Др╕Яр╕ер╣Мр╣Ар╕кр╕╡р╕вр╕Зр╕Чр╕╡р╣И path р╕Щр╕╡р╣Й '{audio_file_path}'")

except Exception as e:
    print(f"тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕Др╕▓р╕Фр╕Др╕┤р╕Ф: {e}")